generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url= env("DATABASE_URL")
}

model User {
  id                Int            @id @default(autoincrement())
  email             String         @unique
  name              String?
  imageUrl          String?
  googleId          String?        @unique
  phone             Int?
  password          String?
  role              Role           @default(USER)
  activated         Boolean        @default(false)
  createdAt         DateTime       @default(now())
  updatedAt         DateTime       @updatedAt
  
  sentMessages      Message[]      @relation("SentMessages")
  conversations     ConversationParticipant[]
}

model Conversation {
  id           Int                        @id @default(autoincrement())
  createdAt    DateTime                   @default(now())
  updatedAt    DateTime                   @updatedAt
  
  participants ConversationParticipant[]
  messages     Message[]
}

model ConversationParticipant {
  id             Int          @id @default(autoincrement())
  conversationId Int
  userId         Int
  joinedAt       DateTime     @default(now())
  lastRead       DateTime?
  
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@unique([conversationId, userId])
}

model Message {
  id             Int          @id @default(autoincrement())
  content        String
  conversationId Int
  senderId       Int
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  sender         User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  
  @@index([conversationId])
  @@index([senderId])
}

enum Role {
  USER
  ADMIN
}
// schema.prisma
model Checklist {
  id        Int      @id @default(autoincrement())
  userId    Int
  date      DateTime @default(now())
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Accueil et évaluation du patient
  typeIntervention       String?
  identiteConfirmee      Boolean  @default(false)
  coteOperer             String?
  autreCote              String?
  etatSiteOperatoire     String?
  allergieMedicamenteuse Boolean  @default(false)
  allergieMateriel       Boolean  @default(false)
  examenPreAG            String?

  // Préparation administrative et éducative - Au service
  consentementVerifie    Boolean  @default(false)
  biaisAdmission         Boolean  @default(false)
  dossierComplet         Boolean  @default(false)
  informationPatient     Boolean  @default(false)
  dossierSoins           Boolean  @default(false)

  // Contrôle des prescriptions médicales
  arretAnticoagulant            Boolean @default(false)
  arretAntiagregantsPlaquettaires Boolean @default(false)
  arretAINS                     Boolean @default(false)
  arretAntidiabetiqueOral       Boolean @default(false)
  ajustementInsuline            Boolean @default(false)
  ajustementCorticoides         Boolean @default(false)
  autreTraitement               Boolean @default(false)
  premedication                 Boolean @default(false)
  perfusionsPrescrites          Boolean @default(false)
  nebulisationOxygenotherapie   Boolean @default(false)
  transfusionSanguine           Boolean @default(false)

  // Préparation physique du patient
  jeunConfirme                  Boolean @default(false)
  examensComplementaires        Boolean @default(false)
  preparationCutanee            Boolean @default(false)
  doucheAntiseptique            Boolean @default(false)
  habillagePatient              Boolean @default(false)
  surveillanceParametresVitaux  Boolean @default(false)

  // Phase préopératoire - Checklist de la salle
  materielSterile        Boolean @default(false)
  epi                    Boolean @default(false)
  systemeAspiration      Boolean @default(false)
  garrouPneumatique      Boolean @default(false)
  bistouriElectrique     Boolean @default(false)
  tableOperatoire        Boolean @default(false)
  scialytique            Boolean @default(false)
  scope                  Boolean @default(false)
  checklistDMI           Boolean @default(false)
  coordinationMateriel   Boolean @default(false)

  // Au bloc opératoire
  preparationChariot         Boolean @default(false)
  accueilPatient             Boolean @default(false)
  verificationIdentite       Boolean @default(false)
  concordanceDossier         Boolean @default(false)
  consentementLibreEclaire   Boolean @default(false)
  confirmationIntervention   Boolean @default(false)
  documentationDisponible    Boolean @default(false)
  retraitBijoux              Boolean @default(false)
  retraitProteses            Boolean @default(false)
  retraitLunettes            Boolean @default(false)
  jeunConfirmeBloc           Boolean @default(false)
  priseEnChargePsy           Boolean @default(false)
  positionnementPatient      Boolean @default(false)
  assistanceMedecin          Boolean @default(false)
  collaborationEquipe        Boolean @default(false)

  // Phase per-opératoire
  realisationPansement   Boolean @default(false)
  interventionIncident   Boolean @default(false)

  // Phase post-opératoire
  gestionComptageMatériel Boolean @default(false)
  tracabiliteRegistre     Boolean @default(false)
  declarationIncident     Boolean @default(false)
  sterilisationMateriel   Boolean @default(false)
  surveillanceTransport   Boolean @default(false)

  // Surveillance immédiate - Au service
  verificationConstantes Boolean @default(false)
  surveillancePansement  Boolean @default(false)
  surveillanceDrains     Boolean @default(false)
  evaluationDouleur      Boolean @default(false)
  surveillanceBiologique Boolean @default(false)
  perfusionTransfusion   Boolean @default(false)
  medicationPrescrite    Boolean @default(false)
  accompagnementLever    Boolean @default(false)
  surveillanceAutonomie  Boolean @default(false)
  aideSoinsHygiene       Boolean @default(false)

  @@unique([userId, date])
  @@index([userId])
  @@index([date])
}


model MedicalForm {
  id                      Int         @id @default(autoincrement())
  userId                  Int?        // Ajoutez le ? pour rendre optionnel
  codeService String?
  createdAt               DateTime    @default(now())
  updatedAt               DateTime    @updatedAt

  // COORDONNÉES
  nom                     String
  prenom                  String
  sexe                    String?
  dateNaissance           DateTime?
  age                     Int?
  nationalite             String?
  matricule               String?
  service                 String?
  lit                     String?
  residence               String?
  telephone               String?
  etatCivil               String?
  couvertureSociale       String[]
  groupeSanguin           String?
  poids                   Float?
  taille                  Float?
  allergie                Boolean     @default(false)
  allergieDetails         String?

  // HOSPITALISATION
  dateHospitalisation     DateTime?
  motifHospitalisation    String?
  diagnosticMedical       String?
  diagnosticChirurgical   String?
  membreConcerne          String[]
  typeIntervention        String[]
  autreIntervention       String?
  dateIntervention        DateTime?
  typeAnesthesie          String[]
  dispositifPlace         String[]

  // ANTÉCÉDENTS
  antecedentsMedicaux     String?
  antecedentsChirurgicaux String?

  // KINÉSITHÉRAPIE
  kinesitherapie          Boolean     @default(false)

  // TRAITEMENTS
  traitements             Treatment[]

  @@map("medical_forms")
}

model Treatment {
  id              Int          @id @default(autoincrement())
  medicalFormId   Int
  medicalForm     MedicalForm  @relation(fields: [medicalFormId], references: [id], onDelete: Cascade)
  
  traitement      String
  dose            String

  @@map("treatments")
}

